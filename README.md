# Zabbix NUT Template

Данный шаблон позволяет мониторить UPS обслуживаемые (совместимые) NUT. При этом непосредственно обработка данных и сам запрос происходят на сервере zabbix, что минимизирует настройку и дальнейшее обслуживание.

Шаблон позволяет вести учет нескольких UPS обслуживаемых одним NUT сервером. Соответственно для каждого UPS будут созданы свои элементы и свои триггеры.
Для каждого сервера NUT необходимо создавать свой узел. Если же использовать шаблон как задумывалось автором размещая скрипты на каждом сервер NUT (т.е. там должен быть установлен zabbix агент), то можно добавлять шаблон к существующим узлам.

1. На серверах NUT разрешаем подключение клиентов с нужных интерфейсов (/etc/nut/upsd.conf параметр LISTEN)
2. nut-ups.conf помещаем в каталог пользовательских конфигураций:
/etc/zabbix/zabbix_agentd.d/nut-ups.conf
3. nut-ups.sh помещаем в каталог скриптов:
/usr/local/share/zabbix/externalscripts/nut-ups.sh
4. Даем nut-ups.sh права на выполнение (проверить от чьего имени запускается заббик агент и ему так же дать соответствующие права)
5. Перезапускаем агент заббикса (sudo systemctl restart zabbix-agent)
6. Импортируем шаблон
7. Создаем узел, добавляем ему интерфейс Тип - Агент, IP Адрес - 127.0.0.1 и порт на котором висит zabbix агент (10050 по умолчанию), добавляем шаблон и макрос {$UPSHOST} равный имени хоста на котором висит NUT (т.е. если мониторим NUT расположенный на устройстве с доменным именем server.mydomain.local, то {$UPSHOST}=server.mydomain.local)
8. Ждем автообнаружения

За основу был взят шаблон с https://sysadminmosaic.ru/nut/nut?redirect=1#zabbix
